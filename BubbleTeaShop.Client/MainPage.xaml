<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:dto="clr-namespace:BubbleTesShop.Backend.DTOs.OrderDtos;assembly=BubbleTesShop.Backend"
    xmlns:viewModels="clr-namespace:BubbleTeaShop.Client.ViewModels"
    xmlns:orderDtos="clr-namespace:BubbleTesShop.Backend.DTOs.OrderDtos;assembly=BubbleTeaShop.Backend"
    x:Class="BubbleTeaShop.Client.MainPage"

    Title="Order History">
    

    <Grid RowDefinitions="Auto, *, Auto">
        <Label Text="Order History"
               FontSize="24"
               FontAttributes="Bold"
               HorizontalOptions="Center"
               Margin="20"
               Grid.Row="0"/>

        <CollectionView ItemsSource="{Binding Orders}" SelectionMode="None" Grid.Row="1">
            <CollectionView.ItemTemplate>
                <DataTemplate x:DataType="orderDtos:OrderDto">
                    <Frame Margin="10,5" Padding="15" CornerRadius="10" BackgroundColor="#F0F8FF" HasShadow="True">
                        <Grid RowDefinitions="Auto, Auto" ColumnDefinitions="*, Auto, Auto" ColumnSpacing="10" VerticalOptions="CenterAndExpand">
                            <VerticalStackLayout Grid.Row="0" Grid.Column="0" Grid.RowSpan="2" VerticalOptions="CenterAndExpand">
                                <Label Text="{Binding OrderDateTime, StringFormat='Order Date: {0:yyyy-MM-dd HH:mm}'}"
                                       FontSize="16" FontAttributes="Bold" TextColor="#333333"/>
                                <Label Text="{Binding Status, StringFormat='Status: {0}'}"
                                       FontSize="14" TextColor="#555555"/>
                                <Label Text="{Binding OrderTotalPrice, StringFormat='Total: {0:C}'}"
                                       FontSize="14" TextColor="#555555"/>
                            </VerticalStackLayout>

                            <Button Grid.Row="0" Grid.Column="1"
                                    Text="Change Status"
                                    Command="{Binding Source={RelativeSource AncestorType={x:Type viewModels:OrderHistoryViewModel}}, Path=ChangeStatusCommand}"
                                    CommandParameter="{Binding .}"
                                    BackgroundColor="#2196F3"
                                    TextColor="White"
                                    CornerRadius="8"
                                    Padding="10,5"
                                    HorizontalOptions="End"
                                    VerticalOptions="Center"/>

                            <Button Grid.Row="1" Grid.Column="1"
                                    Text="View Details"
                                    Command="{Binding Source={RelativeSource AncestorType={x:Type viewModels:OrderHistoryViewModel}}, Path=ViewDetailsCommand}"
                                    CommandParameter="{Binding .}"
                                    BackgroundColor="#4CAF50"
                                    TextColor="White"
                                    CornerRadius="8"
                                    Padding="10,5"
                                    HorizontalOptions="End"
                                    VerticalOptions="Center"/>
                        </Grid>
                    </Frame>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>

        <Button Grid.Row="2"
                Text="Create Order"
                Command="{Binding CreateOrderCommand}"
                BackgroundColor="#FF8C00"
                TextColor="White"
                CornerRadius="10"
                Padding="15,10"
                Margin="20"
                HorizontalOptions="End"
                VerticalOptions="End"/>
    </Grid>
</ContentPage>
